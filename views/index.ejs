<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/stylesheets/style.css" />
</head>

<body>
  <div class="">
    <h1><%= title %></h1>
  </div>
  <div class="">
    <form id="searchForm" action="/" method="get">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" value="<%= searchParams.name || '' %>" autocomplete="off" />

      <label for="height">Height:</label>
      <input type="number" id="height" name="height" value="<%= searchParams.height || '' %>" autocomplete="off" />

      <label for="weight">Weight:</label>
      <input type="number" step="0.01" id="weight" name="weight" value="<%= searchParams.weight || '' %>" autocomplete="off" />

      <label for="startdate">Start Date:</label>
      <input type="date" id="startdate" name="startdate" value="<%= searchParams.startdate || ''  %>" max="2024-12-31" />

      <label for="lastdate">Last Date:</label>
      <input type="date" id="lastdate" name="lastdate" value="<%= searchParams.lastdate || '' %>" max="2024-12-31" />

      <label for="married">Is Married:</label>
      <select id="married" name="married">
        <option value="" style="display: none" disabled selected>--Select--</option>
        <option value=0 <%= searchParams.married === '0' ? 'selected' : '' %>>Not Yet</option>
        <option value=1 <%= searchParams.married === '1' ? 'selected' : '' %>>Yes</option>
      </select>

      <label for="operation">Operation:</label>
      <input type="radio" name="operation" id="operation" value="OR" <%= searchParams.operation === 'OR' ? 'checked' : '' %> checked> OR
      <input type="radio" name="operation" value="AND <%= searchParams.operation === 'AND' ? 'checked' : '' %>"> AND
      <button type="submit">Search</button>
      <a href="/">Reset</a>
    </form>
  </div>
  <div id="data-container">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Height</th>
          <th>Weight</th>
          <th>Birthdate</th>
          <th>Married</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="data-tbody">
        <% if (data.length > 0) { %> <% data.forEach(row => { %>
        <tr>
          <td><%= row.id %></td>
          <td><%= row.name %></td>
          <td><%= row.height %></td>
          <td><%= row.weight %></td>
          <td><%= row.birthdate %></td>
          <td><%= row.married ? 'Yes' : 'No' %></td>
          <td>
            <form action="/edit/<%= row.id %>" method="get">
              <button type="submit">Edit</button>
            </form>
            <button type="button" onclick="showDeleteModal(parseInt(`<%= row.id %>`), `<%= row.name %>`)">Delete</button>
            <!-- <form action="/delete/<%= // row.id %>" method="post">
              <button type="submit" id="deleteBtn">Delete</button>
            </form> -->
          </td>
        </tr>
        <% }) %> <% } else { %>
        <tr>
          <td colspan="7">No data found</td>
        </tr>
        <% } %>
      </tbody>
    </table>
  </div>
  <div class="">
    <div class="">
      <a href="/add"> <button type="button">Add</button></a>
    </div>
    <div class="">
      <!-- Pagination -->
      <% if (total > 0) { %> <% if (page > 1) { %>
      <a href="?page=<%= parseInt(page) === 1 ? 1 : page - 1 %>&<%=searchParamsString%>"><button type="button">Previous</button></a>
      <% } %> <% for (let i = 1; i <= pages; i++) { %>
      <a href="?page=<%= i %>&<%= searchParamsString %>"><button type="button"><%= i %></button></a>
      <% } %> <% if (page < pages) { %>
      <a href="?page=<%= parseInt(page) === pages ? pages : parseInt(page) + 1 %>&<%=searchParamsString%>"><button type="button">Next</button></a>
      <% } %> <% } %>
    </div>
  </div>
  <div>
    <!-- Delete Modal -->
    <div id="deleteModal" class="modal" style="display:none;">
      <div class="modal-content">
        <div class="modal-header">
          <span class="close" onclick="closeDeleteModal()">&times;</span>
          <h2>Confirm Delete</h2>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete <span id="deleteItemName"></span>?</p>
        </div>
        <div class="modal-footer">
          <form id="deleteForm" action="" method="post">
            <button type="submit">Delete</button>
            <button type="button" onclick="closeDeleteModal()">Cancel</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <script>
    function showDeleteModal(id, name) {
      document.getElementById('deleteItemName').innerText = name;
      document.getElementById('deleteForm').action = '/remove/' + id;
      document.getElementById('deleteModal').style.display = 'block';
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').style.display = 'none';
    }
  </script>
</body>

</html>